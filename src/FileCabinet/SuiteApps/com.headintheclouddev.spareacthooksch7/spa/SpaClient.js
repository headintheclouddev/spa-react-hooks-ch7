define(["exports","@uif-js/core/jsx-runtime","@uif-js/core","@uif-js/component","N/query","N/record","N","N/log"],(function(e,t,s,o,n,r,a,c){"use strict";function i(e){const[r,a]=s.useState(""),[c,i]=s.useState(!1),[l,u]=s.useState(""),[d,p]=s.useState(null);s.useEffect((()=>{d&&d.data&&(d.data.length>0?(i(!1),e.dispatch({type:"LOGIN",username:d.data[0].username})):i(!0)),d&&d.error&&i(!0)}),[d]);const x={[o.TextBox.Event.TEXT_CHANGED]:({text:e})=>{console.log("Login username changed to",e),a(e)}};function h(){var e;e={username:r,password:l},n.runSuiteQL.promise({query:"SELECT id FROM contact WHERE entityid = ? AND custentity_blog_password = ?",params:[e.username,e.password]}).then((t=>{const s=t.asMappedResults();s.length?p({data:[{username:e.username,id:s[0].id}]}):p({error:"No match"})}))}const m=r?t.jsx("input",{type:"button",value:"Login",onClick:h}):t.jsx("input",{type:"button",value:"Login",disabled:!0,onClick:h}),y=c?t.jsx("span",{style:{color:"red"},children:" Invalid username or password"}):null;return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"login-username",children:"Username:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.TEXT,name:"login-username",text:r,on:x}),t.jsx("label",{htmlFor:"login-password",children:"Password:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.PASSWORD,name:"login-password",text:l,onTextChanged:function(e){u(e.text)}}),m,y]})}function l(e){return t.jsxs("div",{children:["Logged in as: ",t.jsx("b",{children:e.user})," ",t.jsx(o.Button,{label:"Logout",action:function(){console.log("LOGOUT"),e.dispatch({type:"LOGOUT"})}})]})}function u(e){const[n,a]=s.useState(""),[c,i]=s.useState(""),[l,u]=s.useState(""),[d,p]=s.useState(0);s.useEffect((()=>{d&&e.dispatch({type:"REGISTER",username:n})}),[d]);const x={[o.TextBox.Event.TEXT_CHANGED]:({text:e})=>{console.log("Login username changed to",e),a(e)}};function h(){var e;e={username:n,password:c},r.create.promise({type:"contact"}).then((t=>{t.setValue("subsidiary","1"),t.setValue("entityid",e.username),t.setValue("custentity_blog_password",e.password),t.save.promise().then((e=>{console.log("Successfully created contact",e),p(e)})).catch((e=>{alert(e)}))}))}let m=t.jsx("input",{type:"button",value:"Register",onClick:h});return 0!=n.length&&0!=c.length&&c==l||(m=t.jsx("input",{type:"button",value:"Register",disabled:!0,onClick:h})),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"register-username",children:"Username:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.TEXT,name:"register-username",text:n,on:x}),t.jsx("label",{htmlFor:"register-password",children:"Password:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.PASSWORD,name:"register-password",text:c,onTextChanged:function(e){i(e.text)}}),t.jsx("label",{htmlFor:"register-password-repeat",children:"Repeat password:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.PASSWORD,name:"register-password-repeat",text:l,onTextChanged:function(e){u(e.text)}}),m]})}function d(e){return e.user?t.jsx(l,{user:e.user,dispatch:e.dispatch}):t.jsxs(s.VDom.Fragment,{children:[t.jsx(i,{dispatch:e.dispatch}),t.jsx(u,{dispatch:e.dispatch})]})}const p=s.ContextType.new("theme-context");function x(e){const{secondaryColor:o}=s.useContext(p);return t.jsxs("div",{children:[t.jsx("h3",{style:{color:o},children:e.title}),t.jsx("div",{children:e.content}),t.jsx("br",{}),t.jsxs("i",{children:["Written by ",t.jsx("b",{children:e.author})]})]})}function h(e={posts:[]}){const o=[];for(const n of e.posts)o.push(t.jsx("div",{children:t.jsxs(s.VDom.Fragment,{children:[t.jsx(x,{...n}),t.jsx("hr",{})]})}));return t.jsx("div",{children:o})}function m(e){const[n,a]=s.useState(""),[c,i]=s.useState("");return t.jsxs("div",{children:[t.jsxs("div",{children:["Author: ",t.jsx("b",{children:e.user})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"create-title",children:"Title:"}),t.jsx(o.TextBox,{type:o.TextBox.Type.TEXT,name:"create-title",text:n,onTextChanged:function(e){console.log("handleTitle"),a(e.text)}})]}),t.jsx(o.TextArea,{text:c,onTextChanged:function(e){console.log("handleContent"),i(e.text)}}),t.jsx("input",{type:"button",value:"Create",onClick:function(){var t;t={title:n,content:c,author:e.user},r.create.promise({type:"customrecord_blog_post"}).then((e=>{e.setValue("name",t.title),e.setValue("custrecord_blog_content",t.content),e.save.promise().then((e=>{console.log("Successfully created blog post",e)})).catch((e=>{alert(e)}))})),e.dispatch({type:"CREATE_POST",title:n,content:c,author:e.user})}})]})}function y(e,t){switch(t.type){case"LOGIN":case"REGISTER":return t.username;case"LOGOUT":return"";default:return e}}function j(e,t){switch(console.log("postsReducer state",e),t.type){case"FETCH_POSTS":return t.posts;case"CREATE_POST":return[{title:t.title,content:t.content,author:t.author},...e];default:return e}}function T(e,t){return"POSTS_ERROR"===t.type?"Failed to fetch posts":e}function g(e,t){return console.log("appReducer state",e),{user:y(e.user,t),posts:j(e.posts,t),error:T(e.error,t)}}s.ContextType.new("state-context");const f=e=>{const{primaryColor:o}=s.useContext(p);return t.jsx("h1",{style:{color:o},children:e.text})};function C(e){return t.jsxs("span",{onClick:e.onClick,style:{cursor:"pointer",paddingLeft:"8px",fontWeight:e.active?"bold":"normal"},children:[t.jsx("span",{style:{color:e.theme.primaryColor},children:"Primary"})," / ",t.jsx("span",{style:{color:e.theme.secondaryColor},children:"Secondary"})]})}function S(e){const[o,n]=s.useState([]);function r(t){return t.primaryColor==e.theme.primaryColor&&t.secondaryColor==e.theme.secondaryColor}return s.useEffect((()=>{a.query.runSuiteQL.promise({query:"SELECT name, id, custrecord_blog_theme_secondary_color FROM customrecord_blog_theme"}).then((e=>{const t=e.asMappedResults(),s=[];for(const e of t)s.push({id:e.id,primaryColor:e.name,secondaryColor:e.custrecord_blog_theme_secondary_color});n(s)}))}),[]),t.jsxs("div",{children:["Change theme:",o.map(((s,o)=>t.jsx(C,{theme:s,active:r(s),onClick:()=>e.setTheme(s)},"theme-"+o)))]})}function b(){c.debug("App",`Initializing at ${new Date}`);const[e,o]=s.useState({primaryColor:"deepskyblue",secondaryColor:"coral"}),[r,a]=s.useReducer(g,{user:"",posts:[],error:""}),{user:i,posts:l,error:u}=r;s.useEffect((()=>{n.runSuiteQL.promise({query:"SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author FROM customrecord_blog_post"}).then((e=>{const t=e.asMappedResults();a({type:"FETCH_POSTS",posts:t})}))}),[]),s.useEffect((()=>{l&&l.error&&a({type:"POSTS_ERROR"}),l&&l.data&&a({type:"FETCH_POSTS",posts:l.data.reverse()})}),[l]),s.useEffect((()=>{document.title=i?`${i} - React Hooks Blog`:"React Hooks Blog"}),[i]);const x={[p]:e};return t.jsx(s.VDom.Context,{value:x,children:t.jsxs("div",{style:{padding:8},children:[t.jsx(f,{text:"React Hooks Blog"}),t.jsx(S,{theme:e,setTheme:o}),t.jsx("br",{}),t.jsx(d,{user:i,dispatch:a}),t.jsx("br",{}),i&&t.jsx(m,{user:i,posts:l,dispatch:a}),t.jsx("br",{}),t.jsx("hr",{}),u&&t.jsx("b",{children:u}),t.jsx(h,{posts:l})]})})}e.run=function(e){console.log("SpaClient version 241129a - run",e),e.setLayout("application"),e.setContent(t.jsx(b,{}))}}));
